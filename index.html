<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Run & Reef 2026 æ—…ç¨‹è¦åŠƒ</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6;
            -webkit-tap-highlight-color: transparent;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* Smooth expand animation */
        .activity-details {
            transition: max-height 0.4s ease-in-out, opacity 0.4s ease-in-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        .activity-details.open {
            max-height: 2000px; /* Increased for map image */
            opacity: 1;
        }
        .glass-nav {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0,0,0,0.05);
        }
        .hero-gradient {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #0d9488 100%);
        }
    </style>
</head>
<body class="pb-24">

    <!-- Header Section -->
    <header class="hero-gradient text-white p-6 rounded-b-3xl shadow-lg relative overflow-hidden">
        <div class="absolute top-0 right-0 opacity-10 pointer-events-none">
            <i class="fa-solid fa-person-running text-9xl transform translate-x-10 -translate-y-4"></i>
        </div>
        
        <div class="relative z-10">
            <div class="flex items-center gap-2 mb-2 opacity-80 text-sm">
                <span class="bg-white/20 px-2 py-1 rounded text-xs tracking-widest">AUSTRALIA 2026</span>
            </div>
            <h1 class="text-3xl font-bold mb-1">é›ªæ¢¨é¦¬æ‹‰æ¾ <br>& å¤§å ¡ç¤ä¹‹æ—…</h1>
            
            <!-- Countdown Timer -->
            <div class="mt-6 bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/10">
                <div class="text-xs uppercase tracking-wide opacity-75 mb-1">è·é›¢ 8/30 è³½äº‹æ—¥</div>
                <div class="flex justify-between text-center font-mono" id="countdown">
                    <!-- JS will populate this -->
                    <div class="animate-pulse">è¨ˆç®—ä¸­...</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="p-4 max-w-2xl mx-auto" id="app-container">
        <!-- Rendered by JS -->
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 glass-nav z-50 max-w-2xl mx-auto">
        <div class="flex justify-around items-center h-16 pb-safe">
            <button onclick="switchTab('itinerary')" class="nav-btn active flex-1 flex flex-col items-center justify-center text-blue-600 transition-colors" id="btn-itinerary">
                <i class="fa-solid fa-map-location-dot text-xl mb-1"></i>
                <span class="text-[10px] font-medium">è¡Œç¨‹</span>
            </button>
            <button onclick="switchTab('checklist')" class="nav-btn flex-1 flex flex-col items-center justify-center text-gray-400 hover:text-blue-500 transition-colors" id="btn-checklist">
                <i class="fa-solid fa-clipboard-check text-xl mb-1"></i>
                <span class="text-[10px] font-medium">æ¸…å–®</span>
            </button>
        </div>
    </nav>

    <!-- Hidden File Input for Image Upload -->
    <input type="file" id="imageInput" accept="image/*" class="hidden">

    <script>
        // --- DATA ---
        // åŒ¯ç‡ä¼°ç®—: 1 AUD â‰ˆ 22 TWD
        const itinerary = [
            {
                date: "8/28 (äº”)",
                title: "å‡ºç™¼é›ªæ¢¨",
                location: "Sydney",
                icon: "fa-plane-arrival",
                color: "blue",
                image: "https://www.bring-you.info/imgs/2019/12/sydney-26.jpg",
                desc: "èª¿æ•´æ™‚å·®ï¼Œè¼•é‡è§€å…‰ï¼Œé¿å…éåº¦æ­¥è¡Œã€‚",
                // é£¯åº—åç¨±å¯åœ¨æ­¤ä¿®æ”¹ï¼ŒGoogle Map æœƒè‡ªå‹•æœå°‹é€™å€‹åç¨±
                hotel: { name: "Amora Hotel Jamison Sydney (å¾…å®š)", price: "ç´„ TWD 6,000/æ™š" }, 
                activities: [
                    { time: "AM", text: "æŠµé”é›ªæ¢¨æ©Ÿå ´ (SYD)", type: "transport", query: "Sydney Kingsford Smith Airport", cost: "æ©Ÿç¥¨ç´„ TWD 35,000" },
                    { time: "14:00", text: "å¡”é¾åŠ å‹•ç‰©åœ’ (é–€ç¥¨+çºœè»Š)", type: "must", query: "Taronga Zoo Sydney", note: "å»ºè­°ï¼šæ­æ¸¡è¼ª+çºœè»Šï¼Œåªèµ°ä¸‹å¡", cost: "ç´„ TWD 1,100" },
                    { time: "18:00", text: "ç’°å½¢ç¢¼é ­çœ‹å¤•é™½ (æœ‰æ©Ÿç‡çœ‹åˆ°ç…™ç«)", type: "leisure", query: "Circular Quay", cost: "å…è²»" },
                    { time: "19:00", text: "å²©çŸ³å€æ™šé¤", type: "food", query: "The Rocks Sydney", cost: "ç´„ TWD 900" }
                ]
            },
            {
                date: "8/29 (å…­)",
                title: "è³½å‰å‚™æˆ° & Expo",
                location: "Sydney",
                icon: "fa-person-walking",
                color: "blue",
                image: "https://ppt.cc/fB0BOx@.jpg",
                desc: "é—œéµæ—¥ï¼šæ¸›å°‘ç«™ç«‹ï¼Œé ˜å®Œç‰©è³‡å°±ä¼‘æ¯ã€‚",
                hotel: { name: "Amora Hotel Jamison Sydney (å¾…å®š)", price: "ç´„ TWD 6,000/æ™š" },
                activities: [
                    { time: "09:00", text: "é ˜å–è™Ÿç¢¼å¸ƒ (Expo)", type: "must", query: "ICC Sydney", cost: "å…è²»" },
                    { time: "12:00", text: "QVB é€›è¡—è³¼ç‰© (æ—©åˆé¤)", type: "leisure", query: "Queen Victoria Building", note: "å®¤å…§æœ‰å†·æ°£æ¤…å­å¤š", cost: "ç´„ TWD 700" },
                    { time: "16:00", text: "æµ·å¾·å…¬åœ’ (ç°¡å–®æ‹‰ä¼¸)", type: "leisure", query: "Hyde Park Sydney", cost: "å…è²»" },
                    { time: "18:00", text: "ç¢³æ°´å¤§é¤ (ç¾©å¤§åˆ©éºµ/é£¯)", type: "food", query: "Italian Restaurant Sydney CBD", cost: "ç´„ TWD 800" }
                ]
            },
            {
                date: "8/30 (æ—¥)",
                title: "ğŸ† é›ªæ¢¨é¦¬æ‹‰æ¾",
                location: "Sydney",
                icon: "fa-medal",
                color: "yellow",
                highlight: true,
                image: "https://static.wixstatic.com/media/cbc827_b4bdd14f0e7844f39c6fea368d57a818f000.jpg/v1/fill/w_1920,h_760,al_c,q_85,usm_0.33_1.00_0.00,enc_avif,quality_auto/cbc827_b4bdd14f0e7844f39c6fea368d57a818f000.jpg",
                mapImage: "https://static.wixstatic.com/media/cbc827_1a01b0a040d34e58b68c67b5428a297d~mv2.png/v1/fill/w_963,h_789,fp_0.50_0.31,q_90,usm_0.66_1.00_0.01,enc_avif,quality_auto/2592-A%20SM_Maps_2025-STATIC_SM%5B3%5D.png",
                desc: "Race Day! äº«å—è·¨æµ·å¤§æ©‹èˆ‡æ­ŒåŠ‡é™¢çµ‚é»ç·šã€‚",
                hotel: { name: "Amora Hotel Jamison Sydney (å¾…å®š)", price: "ç´„ TWD 6,000/æ™š" },
                activities: [
                    { time: "05:30", text: "èµ·è·‘é»é›†åˆ", type: "transport", query: "Bradfield Park North Sydney", cost: "äº¤é€šè²»ç´„ TWD 110" },
                    { time: "07:00", text: "START! (å…¨é¦¬èµ·è·‘)", type: "run", query: "Sydney Harbour Bridge", cost: "å ±åè²» (å·²ä»˜)" },
                    { time: "12:00", text: "çµ‚é»ï¼šæ­ŒåŠ‡é™¢å‰å»£å ´", type: "finish", query: "Sydney Opera House", cost: "ç„¡åƒ¹" },
                    { time: "18:00", text: "æ…¶åŠŸå®´ (å’Œç‰›/æµ·é®®)", type: "food", query: "Steakhouse Sydney Rocks", cost: "ç´„ TWD 2,200" }
                ]
            },
            {
                date: "8/31 (ä¸€)",
                title: "é£›å¾€å¤§å ¡ç¤ & è‡ªé§•",
                location: "Airlie Beach",
                icon: "fa-car-side",
                color: "teal",
                image: "https://encrypted-tbn0.gstatic.com/licensed-image?q=tbn:ANd9GcRtH2zu0HUIB9DwwcaJqrIOjD__tZvMkL64q-mEh5lo-1bB7EUWreeqJ-P7hDig347dAaS9II_HwEBgooG8Rv9eEHU&s=19",
                desc: "ç§»å‹•æ—¥ã€‚å–è»Šè‡ªé§•ï¼Œäº«å—ç†±å¸¶æµ·å²¸å…¬è·¯ã€‚",
                hotel: { name: "Airlie Beach æµ·æ™¯å…¬å¯“ (å¾…å®š)", price: "ç´„ TWD 4,500/æ™š" },
                activities: [
                    { time: "AM", text: "é£›å¾€ PPP æ©Ÿå ´ (åœ‹å…§ç·š)", type: "transport", query: "Whitsunday Coast Airport", cost: "æ©Ÿç¥¨ç´„ TWD 4,500" },
                    { time: "13:00", text: "æ©Ÿå ´å–è»Š (ç§Ÿè»Š3å¤©)", type: "transport", query: "Avis Car Rental Proserpine", note: "å³é§•è«‹å°å¿ƒï¼Œå¾€ Airlie Beach ç´„ 30åˆ†", cost: "ç´„ TWD 2,200/å¤©" },
                    { time: "15:00", text: "å…¥ä½ & è¶…å¸‚æ¡è²·", type: "stay", query: "Airlie Beach Woolworths", cost: "é›œæ”¯ç´„ TWD 1,100" },
                    { time: "16:30", text: "Lagoon äººå·¥æ½Ÿæ¹–æ³¡æ°´", type: "relax", query: "Airlie Beach Lagoon", note: "è·‘å¾Œæ’ä¹³é…¸è–åœ°", cost: "å…è²»" }
                ]
            },
            {
                date: "9/1 (äºŒ)",
                title: "â¤ï¸ å¿ƒå‹ç¤é£›è¡Œ",
                location: "Whitsundays",
                icon: "fa-helicopter",
                color: "teal",
                image: "https://lh3.googleusercontent.com/gps-cs-s/AG0ilSxfT3j7iAaOzoYuNPHoQJ5XIjoVV6iRTrQ2pNZMp7TMAVkMhY4ZcsOger0LIVJC8nogC9dzsZsRTOv7JSfr8g_S-HeuQTg4QRYxEuV8TSLU_px_eV39Mt2IM2NZpxv6vXPAZq3i=s1360-w1360-h1020-rw",
                desc: "å¾ç©ºä¸­ä¿¯ç°å¤§å ¡ç¤ã€‚",
                hotel: { name: "Airlie Beach æµ·æ™¯å…¬å¯“ (å¾…å®š)", price: "ç´„ TWD 4,500/æ™š" },
                activities: [
                    { time: "TBD", text: "Scenic Flight (é£›æ©Ÿè§€å…‰)", type: "must", query: "Whitsunday Airport Shute Harbour", note: "è«‹å†æ¬¡ç¢ºèªèµ·é£›èˆªå»ˆ", cost: "ç´„ TWD 6,000" },
                    { time: "PM", text: "Shute Harbour è§€æ™¯", type: "leisure", query: "Shute Harbour Marine Terminal", cost: "å…è²»" },
                    { time: "18:00", text: "æµ·æ¿±æ™šé¤", type: "food", query: "Sorrento Restaurant and Bar Airlie Beach", cost: "ç´„ TWD 1,300" }
                ]
            },
            {
                date: "9/2 (ä¸‰)",
                title: "å¤–å ¡ç¤æµ®æ½›/æ·±æ½›",
                location: "Great Barrier Reef",
                icon: "fa-water",
                color: "teal",
                image: "https://www.hellodive.com/upload/ueditor/image/20190625/1561475070183468.jpg",
                desc: "æ­èˆ¹å‡ºæµ·ï¼Œèˆ‡å°¼è«å…±æ¸¸ã€‚",
                hotel: { name: "Airlie Beach æµ·æ™¯å…¬å¯“ (å¾…å®š)", price: "ç´„ TWD 4,500/æ™š" },
                activities: [
                    { time: "08:00", text: "ç¢¼é ­å ±åˆ° (ä¸€æ—¥éŠèˆ¹)", type: "transport", query: "Port of Airlie", cost: "èˆ¹ç¥¨ç´„ TWD 6,200" },
                    { time: "10:30", text: "æŠµé” Reefworld å¹³å°", type: "play", query: "Hardy Reef", cost: "åŒ…å«åœ¨èˆ¹ç¥¨" },
                    { time: "11:00", text: "æµ®æ½› / æ·±æ½› / ç»ç’ƒèˆ¹", type: "play", query: "", note: "æ³¨æ„é˜²æ›¬ï¼Œäº«å—ç„¡é‡åŠ›æ¼‚æµ®", cost: "æ·±æ½›å¦åŠ  TWD 2,200" },
                    { time: "17:00", text: "è¿”å›ç¢¼é ­ & æ™šé¤", type: "transport", query: "Port of Airlie", cost: "ç´„ TWD 1,100" }
                ]
            },
            {
                date: "9/3 (å››)",
                title: "è¿”ç¨‹",
                location: "Return",
                icon: "fa-plane-departure",
                color: "gray",
                image: "https://img.redocn.com/sheji/20250813/feijijiyigaokongfeixingshijiao_13641383.jpg.400.jpg",
                desc: "å†è¦‹æ¾³æ´²ï¼å›å®¶ã€‚",
                hotel: { name: "ç„¡", price: "-" },
                activities: [
                    { time: "AM", text: "æ—©åˆé¤", type: "food", query: "The Chambers Cairns", cost: "ç´„ TWD 700" },
                    { time: "10:00", text: "å‡±æ©æ–¯ (CNS)", type: "transport", query: "å‡±æ©æ–¯ (CNS)", cost: "æ²¹éŒ¢ç´„ TWD 700" },
                    { time: "PM", text: "é£›å¾€è½‰æ©Ÿé»/å›åœ‹", type: "transport", query: "", cost: "åŒ…å«åœ¨ä¾†å›æ©Ÿç¥¨" }
                ]
            }
        ];

        const checklist = [
            { cat: "æ–‡ä»¶", items: ["è­·ç…§ (æ•ˆæœŸ6å€‹æœˆä»¥ä¸Š)", "æ¾³æ´² ETA ç°½è­‰", "åœ‹éš›é§•ç…§ (è‡ªé§•å¿…å‚™)", "é¦¬æ‹‰æ¾å ±åç¢ºèªä¿¡", "å¿ƒå‹ç¤è¡Œç¨‹é è¨‚å–®"] },
            { cat: "è·‘æ­¥è£å‚™", items: ["æ¯”è³½è·‘é‹ (å·²é¦´é‹)", "è™Ÿç¢¼å¸ƒæ‰£/è…°å¸¶", "èƒ½é‡è†  (Gels)", "é¹½éŒ ", "å‡¡å£«æ— (é˜²ç£¨æ“¦)", "å¢¨é¡/é®é™½å¸½"] },
            { cat: "å¤§å ¡ç¤", items: ["æµ·æ´‹å‹å–„é˜²æ›¬ä¹³", "æ³³è¡£/æ°´æ¯è¡£", "é˜²æ°´ç›¸æ©Ÿ (GoPro)", "æšˆèˆ¹è—¥", "æ²™ç˜æ‹–é‹"] },
            { cat: "é›»å­/å…¶ä»–", items: ["è¬ç”¨è½‰æ¥é ­ (å…«å­—å‹)", "è¡Œå‹•é›»æº", "æ¾³å¹£ç¾é‡‘ (å°‘é‡)", "ä¿¡ç”¨å¡ (æµ·å¤–å›é¥‹é«˜)"] }
        ];

        // --- RENDER FUNCTIONS ---
        
        // 1. Countdown Logic
        function updateCountdown() {
            const raceDate = new Date("2026-08-30T07:00:00+10:00").getTime();
            const now = new Date().getTime();
            const distance = raceDate - now;

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));

            document.getElementById("countdown").innerHTML = `
                <div class="flex flex-col"><span class="text-3xl font-bold">${days}</span><span class="text-[10px] text-gray-300">DAYS</span></div>
                <div class="text-2xl pt-1">:</div>
                <div class="flex flex-col"><span class="text-3xl font-bold">${hours}</span><span class="text-[10px] text-gray-300">HRS</span></div>
                <div class="text-2xl pt-1 opacity-50 text-sm flex items-end pb-2">ç›´åˆ°èµ·è·‘</div>
            `;
        }
        setInterval(updateCountdown, 1000);
        updateCountdown();

        // 2. Render Itinerary
        function renderItinerary() {
            const container = document.getElementById('app-container');
            let html = '<div class="space-y-4 pb-8">';

            itinerary.forEach((day, index) => {
                const isSydney = day.location === "Sydney";
                const badgeColor = isSydney ? "bg-blue-100 text-blue-800" : (day.location === "Return" ? "bg-gray-100 text-gray-600" : "bg-teal-100 text-teal-800");
                const borderColor = day.highlight ? "border-l-4 border-yellow-400 ring-2 ring-yellow-400/20" : "";
                
                // è™•ç†é£¯åº—åœ°åœ–é€£çµ
                const hotelMapLink = day.hotel && day.hotel.name !== "ç„¡" 
                    ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(day.hotel.name)}` 
                    : '#';

                html += `
                <div class="bg-white rounded-2xl shadow-sm overflow-hidden ${borderColor}">
                    <!-- Card Header / Image -->
                    <div class="relative h-40 cursor-pointer group" onclick="toggleCard(${index})">
                        <img src="${day.image}" id="img-${index}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" alt="${day.title}">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"></div>
                        
                        <div class="absolute top-3 right-3 flex gap-2">
                            <!-- <button onclick="triggerUpload(event, ${index})" class="bg-black/30 backdrop-blur text-white p-2 rounded-full hover:bg-white/20 transition text-xs flex items-center gap-1 border border-white/20">
                                    <i class="fa-solid fa-camera"></i> æ›´æ›
                            --> </button>
                            <div class="bg-white/20 backdrop-blur text-white p-2 rounded-full">
                                <i class="fa-solid ${day.icon}"></i>
                            </div>
                        </div>

                        <div class="absolute bottom-3 left-4 text-white">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-xs font-bold bg-white/20 px-2 py-0.5 rounded backdrop-blur-sm">${day.date}</span>
                                <span class="text-[10px] uppercase tracking-wider opacity-90">${day.location}</span>
                            </div>
                            <h3 class="text-xl font-bold leading-tight">${day.title}</h3>
                        </div>
                    </div>

                    <!-- Collapsible Content -->
                    <div id="card-${index}" class="activity-details ${day.highlight ? 'open' : ''}"> <!-- Default open Race Day -->
                        <div class="p-5">
                            <p class="text-sm text-gray-500 mb-4 italic pl-3 border-l-2 border-gray-200">"${day.desc}"</p>
                            
                            <!-- Hotel Info Block -->
                            ${day.hotel ? `
                            <div class="mb-4 bg-gray-50 p-3 rounded-lg border border-gray-100 flex items-start gap-3">
                                <div class="text-blue-500 mt-0.5"><i class="fa-solid fa-hotel"></i></div>
                                <div class="flex-1">
                                    <div class="flex justify-between items-start">
                                        <div class="text-xs text-gray-400 uppercase font-bold tracking-wider">ä½å®¿</div>
                                        ${day.hotel.name !== "ç„¡" ? `
                                        <a href="${hotelMapLink}" target="_blank" class="text-blue-500 bg-blue-50 p-1 rounded-md hover:bg-blue-100 active:scale-95 transition">
                                            <i class="fa-solid fa-location-dot text-xs"></i>
                                        </a>` : ''}
                                    </div>
                                    <div class="font-medium text-gray-800 text-sm mt-1">${day.hotel.name}</div>
                                    <div class="text-xs text-emerald-600 mt-1"><i class="fa-solid fa-coins mr-1"></i>${day.hotel.price}</div>
                                </div>
                            </div>
                            ` : ''}

                            <!-- Map Image for Race Day -->
                            ${day.mapImage ? `
                            <div class="mb-6 mt-2">
                                <div class="text-xs text-gray-400 uppercase font-bold tracking-wider mb-2"><i class="fa-solid fa-map text-yellow-500 mr-1"></i>è³½é“è·¯ç·šåœ–</div>
                                <div class="rounded-lg overflow-hidden border border-gray-200 shadow-sm">
                                    <img src="${day.mapImage}" class="w-full h-auto object-cover" alt="Course Map">
                                </div>
                                <a href="${day.mapImage}" target="_blank" class="block text-center text-xs text-blue-500 mt-1 hover:underline">é»æ“ŠæŸ¥çœ‹å¤§åœ–</a>
                            </div>
                            ` : ''}

                            <div class="space-y-0 relative">
                                <!-- Vertical Line -->
                                <div class="absolute left-[18px] top-2 bottom-4 w-0.5 bg-gray-100"></div>

                                ${day.activities.map(act => {
                                    let iconColor = "text-gray-400";
                                    if(act.type === 'must') iconColor = "text-red-500";
                                    if(act.type === 'transport') iconColor = "text-blue-400";
                                    if(act.type === 'run') iconColor = "text-yellow-500";
                                    
                                    const mapLink = act.query ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(act.query)}` : '#';

                                    return `
                                    <div class="flex gap-4 relative mb-4 last:mb-0">
                                        <div class="flex-none w-10 text-right pt-1 text-xs font-mono text-gray-400 bg-white z-10">${act.time}</div>
                                        <div class="flex-1 pb-2">
                                            <div class="flex justify-between items-start">
                                                <div class="font-medium text-gray-800 text-sm ${act.type === 'must' ? 'font-bold' : ''}">
                                                    ${act.type === 'must' ? '<i class="fa-solid fa-circle-exclamation text-red-500 text-xs mr-1"></i>' : ''}
                                                    ${act.text}
                                                </div>
                                                ${act.query ? `
                                                <a href="${mapLink}" target="_blank" class="flex-none ml-2 text-blue-500 bg-blue-50 p-1.5 rounded-lg hover:bg-blue-100 active:scale-95 transition">
                                                    <i class="fa-solid fa-location-arrow text-xs"></i>
                                                </a>` : ''}
                                            </div>
                                            <div class="flex flex-wrap gap-2 mt-1">
                                                <div class="text-xs text-emerald-600 font-medium bg-emerald-50 px-2 py-0.5 rounded border border-emerald-100">
                                                    <i class="fa-solid fa-coins mr-1 text-[10px]"></i>${act.cost}
                                                </div>
                                                ${act.note ? `<div class="text-xs text-orange-600 bg-orange-50 px-2 py-0.5 rounded border border-orange-100"><i class="fa-solid fa-circle-info mr-1"></i>${act.note}</div>` : ''}
                                            </div>
                                        </div>
                                    </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Expand Toggle (Visual Cue) -->
                    <div class="text-center py-2 border-t border-gray-50 bg-gray-50 cursor-pointer hover:bg-gray-100" onclick="toggleCard(${index})">
                        <i class="fa-solid fa-chevron-down text-gray-400 text-xs transition-transform duration-300" id="chevron-${index}"></i>
                    </div>
                </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }

        // 3. Render Checklist
        function renderChecklist() {
            const container = document.getElementById('app-container');
            let html = '<div class="space-y-6 pb-8 bg-white p-6 rounded-2xl shadow-sm">';
            html += '<h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ’ å¿…å‚™è¡Œå›Šæ¸…å–®</h2>';
            
            checklist.forEach((cat, idx) => {
                html += `
                <div class="mb-6 last:mb-0">
                    <h3 class="text-sm font-bold text-blue-600 uppercase tracking-wide mb-3 border-b pb-1">${cat.cat}</h3>
                    <ul class="space-y-3">
                        ${cat.items.map((item, i) => `
                        <li class="flex items-center gap-3 group cursor-pointer" onclick="toggleCheck(this)">
                            <div class="w-5 h-5 rounded border-2 border-gray-300 flex items-center justify-center text-white transition-colors group-hover:border-blue-400 check-box">
                                <i class="fa-solid fa-check text-xs"></i>
                            </div>
                            <span class="text-gray-700 text-sm transition-all check-text select-none">${item}</span>
                        </li>
                        `).join('')}
                    </ul>
                </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }

        // --- INTERACTION FUNCTIONS ---

        function switchTab(tab) {
            // Update buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-blue-600', 'text-gray-400');
                if(btn.id === `btn-${tab}`) {
                    btn.classList.add('text-blue-600');
                } else {
                    btn.classList.add('text-gray-400');
                }
            });

            // Render content
            if(tab === 'itinerary') {
                renderItinerary();
                // Restore state if needed (simple version re-renders)
            } else {
                renderChecklist();
            }
        }

        function toggleCard(index) {
            const content = document.getElementById(`card-${index}`);
            const chevron = document.getElementById(`chevron-${index}`);
            
            if (content.classList.contains('open')) {
                content.classList.remove('open');
                chevron.style.transform = 'rotate(0deg)';
            } else {
                content.classList.add('open');
                chevron.style.transform = 'rotate(180deg)';
            }
        }

        function toggleCheck(el) {
            const box = el.querySelector('.check-box');
            const text = el.querySelector('.check-text');
            
            if (box.classList.contains('bg-blue-500')) {
                // Uncheck
                box.classList.remove('bg-blue-500', 'border-blue-500');
                box.classList.add('border-gray-300');
                text.classList.remove('line-through', 'text-gray-400');
                text.classList.add('text-gray-700');
            } else {
                // Check
                box.classList.remove('border-gray-300');
                box.classList.add('bg-blue-500', 'border-blue-500');
                text.classList.add('line-through', 'text-gray-400');
                text.classList.remove('text-gray-700');
            }
        }

        // --- IMAGE UPLOAD LOGIC ---
        let currentUploadIndex = null;

        function triggerUpload(e, index) {
            e.stopPropagation(); // Prevent card toggle
            currentUploadIndex = index;
            document.getElementById('imageInput').click();
        }

        document.getElementById('imageInput').addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Update data model (in memory)
                    itinerary[currentUploadIndex].image = e.target.result;
                    // Update DOM directly
                    document.getElementById(`img-${currentUploadIndex}`).src = e.target.result;
                }
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        // Initialize
        renderItinerary();

    </script>
</body>
</html>
